;###########SET UP #############
	include "P16F887.inc"
	LIST	P=16F887	;####List Directive To define Processer
	__CONFIG _CONFIG1, _INTRC_OSC_NOCLKOUT & _WDT_OFF & _MCLRE_ON & _LVP_OFF & _CP_OFF
	COUNT EQU	20H ;####COUNT is used for time how long each animation plays before switching to the next one

;DEFINE ENTRY VECTORS
	ORG	0	;### Start address in memory is 0
	

;######### READY PROGRAM #######

	 	BANKSEL	OSCCON
		MOVLW	B'01011000' ;####Sets clock speed to 2MHz
		MOVWF	OSCCON

		BANKSEL OPTION_REG
		MOVLW	B'11010111' ; ####Sets TMR0 to internal clock and assigns Prescaler to TMR0
		MOVWF	OPTION_REG
		


;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		BANKSEL	TRISA
		MOVLW	B'00000000' ;### Sets PORT A,B,C to outputs
		MOVWF	TRISA
		MOVWF	TRISB
		MOVWF	TRISC ;### Portc is only used to display timing values on development board for debuging
		BANKSEL PORTA
		MOVLW	B'00000000'
		MOVWF	PORTA
		MOVWF	PORTB
		MOVWF	PORTC
		

;######### PROGRAM START #######
;#This section just calls all the different animation subroutines in the sepecified order.
;# each one displays its animation for its own set time then returns to this section
;# where the next routine is called

START	CLRF	COUNT ;### set count to zero ready to be used
		CALL 	ALLON
		CALL	SPIN
		CALL	PULL
		CALL	RAIN
		CALL	TESTAN
		GOTO	START

;######### TIMERS #############
;# This section contains various subroutines involved with timing or delaying the circuit		
DELAY1S	CLRF	TMR0 ;# Starts TMR0 counting down for 1 second
		MOVLW	.121
		MOVWF	TMR0
		RETURN

DELAY250M	CLRF	TMR0 ;# Starts TMR0 counting down for a quarter of a second
		MOVLW	.30
		MOVWF	TMR0
		RETURN

NOP10 	NOP ;# Calls 10 NOPs. Used after setting a layer of the cube, so that it is displayed for some time before showing the next layer.
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP	
		RETURN

;######## ANIMATIONS ##########
TESTAN	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT ;#increment ‘COUNT’ at beginning
		CALL	DELAY250M ;# set how long next frame should be displayed for. In this case quarter of a second
		CALL	TEST ;# display frame called ‘TEST’. Timeing check is included inside
		MOVFW	COUNT
		SUBLW	.10 ;# this animation should loop 10 times before showing next one
		BTFSS	STATUS,2 ;# test if count is 10
		GOTO 	TESTAN ;# if it is NOT 10 then display animation again
		CLRF 	COUNT ;# if it IS 10 then reset counter and return to next animation
		RETURN

BALLAN	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT
		CALL	DELAY250M
		CALL	BALL
		MOVFW	COUNT
		SUBLW	.10
		BTFSS	STATUS,2
		GOTO 	BALLAN
		CLRF 	COUNT
		RETURN		
		

ALLON	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT
		CALL	DELAY250M
		CALL	ALLONP
		MOVFW	COUNT
		SUBLW	.10
		BTFSS	STATUS,2
		GOTO	ALLON
		CLRF	COUNT
		RETURN

RAIN	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT
		MOVWF 	PORTC

		CALL	DELAY250M
		CALL	RAIN1
		CALL	DELAY250M	
		CALL	RAIN2
		CALL	DELAY250M
		CALL	RAIN3
		CALL	DELAY250M	
		CALL	RAIN4
		CALL	DELAY250M
		CALL	RAIN5
		CALL	DELAY250M	
		CALL	RAIN6
		CALL	DELAY250M	
		CALL	RAIN7

		MOVFW	COUNT
		SUBLW	.10
		BTFSS	STATUS,2
		GOTO	RAIN
		CLRF	COUNT
		RETURN
				
SPIN	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT
		MOVWF	PORTC

		CALL	DELAY250M
		CALL	SPIN1
		CALL	DELAY250M	
		CALL	SPIN2
		CALL	DELAY250M
		CALL	SPIN3
		CALL	DELAY250M	
		CALL	SPIN4

		MOVFW	COUNT
		SUBLW	.10
		BTFSS	STATUS,2
		GOTO	SPIN
		CLRF	COUNT
		RETURN

PULL	MOVFW	COUNT
		ADDLW	.1
		MOVWF	COUNT
		MOVWF	PORTC

		CALL	DELAY250M
		CALL	PULL1
		CALL	DELAY250M	
		CALL	PULL2
		CALL	DELAY250M
		CALL	PULL3
		CALL	DELAY250M	
		CALL	PULL4
		CALL	DELAY250M
		CALL	PULL5
		CALL	DELAY250M
		CALL	PULL6
		CALL	DELAY250M	
		CALL	PULL7
		CALL	DELAY250M
		CALL	PULL8
		;CALL	DELAY250M	
		;CALL	PULL9


		MOVFW	COUNT
		SUBLW	.10
		BTFSS	STATUS,2
		GOTO	PULL
		CLRF	COUNT
		RETURN



;######### FRAMES #############
;# each of these, are still frames of all 27 LEDs 
;------------------------------------
BALL	CALL 	NOP10 ; wait for 10 cycles
		CLRF	PORTB ; Stop outputing
		MOVLW	B'00010000' ; set output for PORTA columns for 1st layer 
		MOVWF	PORTA
		MOVLW	B'00001000' ; set output for PORTB column for 1st layer
		MOVWF	PORTB

		CALL	NOP10 ;wait 10 cycles while displaying 1st layer 
		CLRF	PORTB ; stop displaying 1st layer
		MOVLW	B'10111010' ; setup PORTA coloumns output to 2nd layer
		MOVWF	PORTA
		MOVLW	B'00000100' ;set output PORTB coloumn for 2nd layer
		MOVWF	PORTB
	
		CALL 	NOP10
		CLRF	PORTB
		MOVLW	B'00010000'
		MOVWF	PORTA
		MOVLW	B'00000010'
		MOVWF	PORTB
		
		CALL 	NOP10 
		MOVF	TMR0,W ; move TMR0 value to W reg, for checking time
		BTFSS	STATUS,2 ; check if TMR0 value is 0
		GOTO	BALL ; if TMR0 is NOT 0
		RETURN ;if TMR0 is 0

;--------------------------------------
RAIN1	MOVLW	B'01000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN1
	RETURN
;--------------------

RAIN2	MOVLW	B'01000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10001000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN2
	RETURN
;-------------------
RAIN3	MOVLW	B'01000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10001000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00010001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN3
	RETURN
;--------------------------
RAIN4	MOVLW	B'10001000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00010001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00100010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN4
	RETURN

;-----------------
RAIN5	MOVLW	B'00010001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00100010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN5
	RETURN

;----------------------
RAIN6	MOVLW	B'00100010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN6
	RETURN
;-----------------------
RAIN7	MOVLW	B'00000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	RAIN7
	RETURN
;############################

SPIN1	MOVLW	B'10000010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'01000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00101000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	SPIN1
	RETURN
;---------------------------------
SPIN2	MOVLW	B'00000001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10000010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'01000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	SPIN2
	RETURN
;------------------------------
SPIN3	MOVLW	B'00101000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10000010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	SPIN3
	RETURN
;----------------------------
SPIN4	MOVLW	B'01000100'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00101000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000001'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	SPIN4
	RETURN
;###############################
PULL1	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL1
	RETURN
;---------------------
PULL2	MOVLW	B'11101111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00010000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL2
	RETURN
;-----------------
PULL3	MOVLW	B'01000101'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10101010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00010000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL3
	RETURN

;-------------------------
PULL4	MOVLW	B'01000101'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10111010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL4
	RETURN
;--------------------
PULL5	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL5
	RETURN
;------------------------
PULL6	MOVLW	B'00010000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'11101111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL6
	RETURN
;------------------------
PULL7	MOVLW	B'00010000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'10101010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'01000101'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL7
	RETURN
;----------------------------
PULL8	MOVLW	B'10111010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'01000101'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL8
	RETURN
;--------------------------
PULL9	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PULL9
	RETURN

;---------------------------
PHOTO	MOVLW	B'00000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001000'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000100'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'00000010'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000010'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	PHOTO
	RETURN

;--------------------------------------
ALLONP 	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'11111111'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	ALLONP
	RETURN
;-------------------------------------
TEST	MOVLW	B'11000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00001001'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'11000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000101'
	MOVWF	PORTB
	CALL	NOP10

	MOVLW	B'11000000'
	CLRF	PORTB
	MOVWF	PORTA
	MOVLW	B'00000011'
	MOVWF	PORTB
	CALL	NOP10

	MOVF	TMR0,W
	BTFSS	STATUS,2
	GOTO	TEST
	RETURN
;--------------------------------------
END